/*
* Kendo UI v2015.1.408 (http://www.telerik.com/kendo-ui)
* Copyright 2015 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.dom.min","./kendo.data.min"],e)}(function(){return function(e,t){function n(e){var n="string"==typeof e?[{name:e}]:e,i="[object Array]"===wt.call(n)?n:n!==t?[n]:[];return bt(i,function(e){return"string"==typeof e?{name:e}:{name:e.name,type:e.type}})}function i(e){var n="string"==typeof e?[{name:[e],expand:!1}]:e,i="[object Array]"===wt.call(n)?n:n!==t?[n]:[];return bt(i,function(e){return"string"==typeof e?{name:[e],expand:!1}:{name:"[object Array]"===wt.call(e.name)?e.name.slice():[e.name],expand:e.expand}})}function o(e,t,n,i){var r,a,s,l;if(n||(n=t),i||(i=0),l=n.members[i],l&&!l.measure){if(s=l.children,a=s.length,n===t?e[pt.stringify([l.name])]=!!a:a&&(e[pt.stringify(lt(n,i))]=!0),a)for(r=0;a>r;r++)o(e,t,s[r],i);o(e,t,n,i+1)}}function r(t){var n,i,r={};t.length&&o(r,t[0]),n=[];for(i in r)n.push({name:e.parseJSON(i),expand:r[i]});return n}function a(e,t){var n,i,o,r,a=t.tuples||[],s=a[0];if(s&&s.members.length>e.length)for(n=s.members,i=0;n.length>i;i++)if(!n[i].measure){for(o=!1,r=0;e.length>r;r++)if(0===O(e[r]).indexOf(n[i].hierarchy)){o=!0;break}o||e.push({name:[n[i].name],expand:!1})}}function s(e){var t,n=[],i=e.members;for(t=0;i.length>t;t++)i[t].measure||n.push({name:[i[t].name],expand:i[t].children.length>0});return n}function l(e,t,n){var o,r;return e=e||{},a(t,e),n.length>1&&t.push({name:"Measures",measure:!0,children:i(n)}),o={members:t},e.tuples&&(r=k(e.tuples,o),r.tuple&&(t=s(r.tuple))),t}function c(e,t,n,i,o,r,a){var s,l,c,d,u,h,f,p=0,g=t;for(l in n[i].aggregates)s=n[i].aggregates[l],d=o[l],u=r[l],s=d?d(s):s.accumulator,e[g]={ordinal:g,value:s,fmtValue:u?pt.format(u,s):s},++p,g+=a;h=n[i].items;for(c in h){f=h[c].index*p,f=g+f*a;for(l in h[c].aggregates)s=h[c].aggregates[l],d=o[l],u=r[l],s=d?d(s):s.accumulator,e[f]={ordinal:f,value:s,fmtValue:u?pt.format(u,s):s},f+=a}}function d(e,t,n,i,o,r){var a,s,l,c,d,u,h,f=0;for(s in n[i].aggregates)a=n[i].aggregates[s],c=o[s],d=r[s],a=c?c(a):a.accumulator,e[e.length]={ordinal:t++,value:a,fmtValue:d?pt.format(d,a):a},++f;u=n[i].items;for(l in u){h=u[l].index*f;for(s in u[l].aggregates)a=u[l].aggregates[s],c=o[s],d=r[s],a=c?c(a):a.accumulator,e[e.length]={ordinal:t+h++,value:a,fmtValue:d?pt.format(d,a):a}}}function u(e){var t=pt.getter(e.field,!0);return function(n,i){return e.aggregate(t(n.dataItem),i,n)}}function h(e){return"number"==typeof e&&!isNaN(e)}function f(e){return e&&e.getTime}function p(e,n,i){return e.tuples.length<_(n.tuples,i)?n:t}function g(e,t,n,i,o){var r,a,s,l=e.length,c=_(t,i),d=i.length||1;for(a=0;n>a;a++)for(r=0;l>r;r++)s=v(e[r],t)*d,s+=r%d,o[a*l+r].ordinal=a*c+s}function m(e,t,n,i,o){var r,a,s,l=e.length,c=(_(t,i),i.length||1);for(a=0;l>a;a++)for(s=v(e[a],t),s*=c,s+=a%c,r=0;n>r;r++)o[a*n+r].ordinal=s*n+r}function v(e,t){return k(t,e).index}function _(e,t){var n,i,o;if(!e.length)return 0;for(n=e.slice(),i=n.shift(),o=1;i;)i.members?[].push.apply(n,i.members):i.children&&(i.measure||(o+=i.children.length),[].push.apply(n,i.children)),i=n.shift();return t.length&&(o*=t.length),o}function w(e){return e||(e={tuples:[]}),e.tuples||(e.tuples=[]),e}function y(e,t,n){var i,o,r;if(!e)return 0;for(i=Math.max(n.length,1),o=e.members.slice(0,t),r=o.shift();r;)r.children?[].push.apply(o,r.children):(i++,[].push.apply(o,r.members)),r=o.shift();return i}function b(e,t,n){var i,o,r,a,s,l;if(!t[0])return{parsedRoot:null,tuples:e,memberIndex:0,index:0};if(i=k(e,t[0]),!i.tuple)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};if(o=i.tuple.members,r=t[0].members,a=-1,o.length!==r.length)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};for(s=0,l=o.length;l>s;s++)!o[s].measure&&r[s].children[0]&&(-1==a&&r[s].children.length&&(a=s),o[s].children=r[s].children);return n=Math.max(n.length,1),{parsedRoot:i.tuple,index:i.index*n,memberIndex:a,tuples:e}}function x(e,t){var n,i,o=!0;for(e=e.members,t=t.members,n=0,i=e.length;i>n;n++)e[n].measure||t[n].measure||(o=o&&O(e[n])===O(t[n]));return o}function k(e,t){var n,i,o,r,a,s,l,c=0;for(n=0,i=e.length;i>n;n++){if(o=e[n],x(o,t))return{tuple:o,index:c};for(c++,a=0,s=o.members.length;s>a;a++)if(l=o.members[a],!l.measure&&(r=k(l.children,t),c+=r.index,r.tuple))return{tuple:r.tuple,index:c}}return{index:c}}function C(e,t){var n,i,o,r="";for(i=0,o=e.length;o>i;i++)n=e[i],r+=n.name,t[r]||(t[r]=n)}function S(e,t){var n,i,o,r,a=e.members,s="",l="";for(n=0,i=a.length;i>n;n++){if(o=a[n],r){if(t[s+o.name]){s+=o.name,r=t[s];continue}return t[s+o.parentName]?t[s+o.parentName]:(o.parentName&&(l+=o.parentName),t[l])}if(s+=o.name,r=t[o.parentName],!r&&(r=t[s],!r))return null;r&&(l+=r.name)}return r}function T(e,t){var n,i,o,r;if(0===t.length)return-1;for(n=t[0],i=e.members,o=0,r=i.length;r>o;o++)if(i[o].name==n.name)return o}function D(n,i){if(!(0>i)){var o={name:"Measures",measure:!0,children:[e.extend({members:[],dataIndex:n.dataIndex},n.members[i])]};n.members.splice(i,1,o),n.dataIndex=t}}function A(e,t){var n,i,o,r,a,s;if(1>e.length)return[];for(n=[],i={},o=T(e[0],t),r=0;e.length>r;r++)a=e[r],a.dataIndex=r,D(a,o),s=S(a,i),s?s.children.push(0>o||!s.measure?a:a.members[o].children[0]):n.push(a),C(a.members,i);return n}function P(e,t){var n,i,o,r,a,s,l,c,d;if(!e||!e.length)return t;for(n=[],i=E(e),o=i.length,r=Math.max(t.length/o,1),a=0;o>a;a++)for(l=r*a,c=r*i[a],s=0;r>s;s++)d=parseInt(c+s,10),n[parseInt(l+s,10)]=t[d]||{value:"",fmtValue:"",ordinal:d};return n}function M(e,t){var n,i,o,r,a,s,l,c;if(!e||!e.length)return t;for(n=[],i=E(e),o=i.length,r=Math.max(t.length/o,1),s=0;r>s;s++)for(l=o*s,a=0;o>a;a++)c=i[a]+l,n[l+a]=t[c]||{value:"",fmtValue:"",ordinal:c};return n}function E(e){var n,i,o,r,a,s,l;for(e=e.slice(),n=[],i=e.shift();i;){for(i.dataIndex!==t&&n.push(i.dataIndex),a=0,o=0,r=i.members.length;r>o;o++)l=i.members[o],s=l.children,l.measure?[].splice.apply(e,[0,0].concat(s)):[].splice.apply(e,[a,0].concat(s)),a+=s.length;i=e.shift()}return n}function I(e){var t=e.split(".");return t.length>2?t[0]+"."+t[1]:e}function B(e,t){var n=e.length-1,i=e[n],o=z(t,i);return o&&o.dir?i="ORDER("+i+".Children,"+o.field+".CurrentMember.MEMBER_CAPTION,"+o.dir+")":i+=".Children",e[n]=i,e}function z(e,t){for(var n=0,i=e.length;i>n;n++)if(0===t.indexOf(e[n].field))return e[n];return null}function L(e){var t,n="CROSSJOIN({";return e.length>2?(t=e.pop(),n+=L(e)):(n+=e.shift(),t=e.pop()),n+="},{",n+=t,n+="})"}function F(e,t){var n=e.slice(0);return t.length>1&&n.push("{"+R(t).join(",")+"}"),L(n)}function R(e){for(var n,i=0,o=e.length,r=[];o>i;i++)n=e[i],r.push(n.name!==t?n.name:n);return r}function O(e){return e=e.name||e,"[object Array]"===wt.call(e)&&(e=e[e.length-1]),e}function N(e){for(var t=e.length,n=[],i=0;t>i;i++)n.push(e[i].name[0]);return n}function H(e,t){var n,i,o,r=0,a=e.length,s=t.length;for(t=t.slice(0);a>r;r++)for(n=e[r],o=0;s>o;o++)if(i=I(t[o]),-1!==n.indexOf(i)){t[o]=n;break}return t}function V(e){for(var t,n,i,o,r,a,s=[],l=[],c=[],d=0,u=e.length;u>d;d++)if(t=e[d],o=t.name,a=!1,"[object Array]"!==wt.call(o)&&(t.name=o=[o]),o.length>1)l.push(t);else{for(r=I(o[0]),n=0,i=c.length;i>n;n++)if(0===c[n].name[0].indexOf(r)){a=!0;break}a||c.push(t),t.expand&&s.push(t)}return s=s.concat(l),{root:c,expanded:s}}function U(e,t,n){var i,o,r,a,s,l,c,d,u="";if(e=e||[],i=V(e),o=i.root,r=N(o),a=[],i=i.expanded,s=i.length,l=0,d=[],r.length>1||t.length>1){for(a.push(F(r,t));s>l;l++)c=B(i[l].name,n),d=H(c,r),a.push(F(d,t));u+=a.join(",")}else{for(;s>l;l++)c=B(i[l].name,n),d.push(c[0]);u+=r.concat(d).join(",")}return u}function W(e){var t="",n=e.value,i=e.field,o=e.operator;return"in"==o?(t+="{",t+=n,t+="}"):(t+="Filter(",t+=i+".MEMBERS",t+=pt.format(Y[o],i,n),t+=")"),t}function j(e,t){var n,i,o="",r=e.filters,a=r.length;for(i=a-1;i>=0;i--)n="SELECT (",n+=W(r[i]),n+=") ON 0",i==a-1?(n+=" FROM ["+t+"]",o=n):o=n+" FROM ( "+o+" )";return o}function G(e,t,n){var i,o,r="";if(t){r+="<"+e+">";for(o in t)i=t[o],n&&(o=o.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g,"$1_").toUpperCase().replace(/_$/,"")),r+="<"+o+">"+i+"</"+o+">";r+="</"+e+">"}else r+="<"+e+"/>";return r}function q(e){if(null==e)return[];var t=wt.call(e);return"[object Array]"!==t?[e]:e}function $(e){var t,n,i,o,r={tuples:[]},a=q(pt.getter("Tuples.Tuple",!0)(e)),s=pt.getter("Caption['#text']"),l=pt.getter("UName['#text']"),c=pt.getter("LName['#text']"),d=pt.getter("LNum['#text']"),u=pt.getter("CHILDREN_CARDINALITY['#text']",!0),h=pt.getter("['@Hierarchy']"),f=pt.getter("PARENT_UNIQUE_NAME['#text']",!0);for(t=0;a.length>t;t++){for(n=[],i=q(a[t].Member),o=0;i.length>o;o++)n.push({children:[],caption:s(i[o]),name:l(i[o]),levelName:c(i[o]),levelNum:d(i[o]),hasChildren:parseInt(u(i[o]),10)>0,parentName:f(i[o]),hierarchy:h(i[o])});r.tuples.push({members:n})}return r}var Y,Q,X,K,Z,J,et,tt,nt,it,ot,rt,at,st,lt,ct,dt,ut,ht,ft,pt=window.kendo,gt=pt.ui,mt=pt.Class,vt=gt.Widget,_t=pt.data.DataSource,wt={}.toString,yt=function(e){return e},bt=e.map,xt=e.extend,kt=pt.isFunction,Ct="change",St="error",Tt="progress",Dt="stateReset",At="auto",Pt="<div/>",Mt=".kendoPivotGrid",Et="__row_total__",It="dataBinding",Bt="dataBound",zt="expandMember",Lt="collapseMember",Ft="k-i-arrow-s",Rt="k-i-arrow-e",Ot="#: data.member.caption || data.member.name #",Nt='<span class="k-icon k-i-kpi-#=data.dataItem.value > 0 ? "open" : data.dataItem.value < 0 ? "denied" : "hold"#">#:data.dataItem.value#</span>',Ht='<span class="k-icon k-i-kpi-#=data.dataItem.value > 0 ? "increase" : data.dataItem.value < 0 ? "decrease" : "equal"#">#:data.dataItem.value#</span>',Vt='#= data.dataItem ? kendo.htmlEncode(data.dataItem.fmtValue || data.dataItem.value) || "&nbsp;" : "&nbsp;" #',Ut='<table class="k-pivot-layout"><tr><td><div class="k-pivot-rowheaders"></div></td><td><div class="k-pivot-table k-state-default"></div></td></tr></table>',Wt={sum:function(e,t){var n=t.accumulator;return h(n)?h(e)&&(n+=e):n=e,n},count:function(e,t){return(t.accumulator||0)+1},average:{aggregate:function(e,n){var i=n.accumulator;return n.count===t&&(n.count=0),h(i)?h(e)&&(i+=e):i=e,h(e)&&n.count++,i},result:function(e){var t=e.accumulator;return h(t)&&(t/=e.count),t}},max:function(e,t){var n=t.accumulator;return h(n)||f(n)||(n=e),e>n&&(h(e)||f(e))&&(n=e),n},min:function(e,t){var n=t.accumulator;return h(n)||f(n)||(n=e),n>e&&(h(e)||f(e))&&(n=e),n}},jt=mt.extend({init:function(e){this.options=xt({},this.options,e),this.dimensions=this._normalizeDescriptors("field",this.options.dimensions),this.measures=this._normalizeDescriptors("name",this.options.measures)},_normalizeDescriptors:function(e,t){var n,i,o,r;if(t=t||{},n={},"[object Array]"===wt.call(t)){for(o=0,r=t.length;r>o;o++)i=t[o],"string"==typeof i?n[i]={}:i[e]&&(n[i[e]]=i);t=n}return t},_asTuples:function(e,n,i){var o,r,a,s,l,c,d,u,h,f;if(i=i||[],o=this.dimensions||[],r=[],h=i.length||1,n.length||i.length)for(c=0;h>c;c++){for(a={members:[]},s=0,l=n.length;l>s;s++)u=O(n[s].name),a.members[a.members.length]={children:[],caption:(o[u]||{}).caption||"All",name:u,levelName:u,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:u};h>1&&(a.members[a.members.length]={children:[],caption:i[c].caption,name:i[c].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!1,parentName:t,hierarchy:"MEASURES"}),r[r.length]=a}for(f in e)for(c=0;h>c;c++){for(d={members:[]},s=0,l=n.length;l>s;s++)u=O(n[s].name),d.members[d.members.length]=0===e[f].parentName.indexOf(u)?{children:[],caption:e[f].value,name:e[f].name,levelName:e[f].name,levelNum:1,hasChildren:!1,parentName:u,hierarchy:u}:{children:[],caption:(o[u]||{}).caption||"All",name:u,levelName:u,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:u};h>1&&(d.members[d.members.length]={children:[],caption:i[c].caption,name:i[c].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!0,parentName:t,hierarchy:"MEASURES"}),r[r.length]=d}return r},_toDataArray:function(e,t,n,i,o){var r,a,s,l,c,d,u={},h={},f=0,p=n&&n.length;if(p)for(r=this.measures||{};p>f;f++)s=n[f].name,a=r[s],a.result&&(h[s]=a.result),a.format&&(u[s]=a.format);l=[],c=0,o(l,c,e,Et,h,u,t);for(d in e)d!==Et&&(c+=i,o(l,c,e,d,h,u,t));return l},_matchDescriptors:function(e,t,n,i){for(var o,r,a,s,l;i>0;)if(o=t[--i],r=O(o).split("&"),r.length>1&&(a=r[0],s=r[1],l=n[a],l(e)!=s))return!1;return!0},_isExpanded:function(e){for(var t=0,n=e.length;n>t;t++)if(e[t].expand)return!0;return!1},_calculateAggregate:function(e,t,n){var i,o,r,a={};for(r=0;e.length>r;r++)o=e[r].descriptor.name,i=n.aggregates[o]||{},i.accumulator=e[r].aggregator(t,i),a[o]=i;return a},_processColumns:function(e,n,i,o,r,a,s,l){var c,d,u,h,f,p,g=r.dataItem;for(p=0;n.length>p;p++)if(d=n[p],d.expand){if(!this._matchDescriptors(g,n,i,p))continue;u=O(d),c=i[u](g),c=c!==t?""+c:c,u=u+"&"+c,h=o[u]||{index:s.columnIndex,name:u,parentName:u,value:c},f=a.items[u]||{aggregates:{}},a.items[u]={index:h.index,aggregates:this._calculateAggregate(e,r,f)},l&&(o[u]||s.columnIndex++,o[u]=h)}},_measureAggregators:function(e){var t,n,i,o,r,a,s=e.measures||[],l=this.measures||{},c=[];if(s.length){for(i=0,o=s.length;o>i;i++)if(t=s[i],n=l[t.name],r=null,n){if(a=n.aggregate,"string"==typeof a){if(r=Wt[a.toLowerCase()],!r)throw Error("There is no such aggregate function");n.aggregate=r.aggregate||r,n.result=r.result}c.push({descriptor:t,caption:n.caption,result:n.result,aggregator:u(n)})}}else c.push({descriptor:{name:"default"},caption:"default",aggregator:function(){return 1}});return c},_buildGetters:function(e){var t,n,i,o,r,a={};for(o=0,r=e.length;r>o;o++)t=e[o],i=O(t),n=i.split("&"),n.length>1?a[n[0]]=pt.getter(n[0],!0):a[i]=pt.getter(i,!0);return a},process:function(e,n){var o,r,a,s,l,u,h,f,p,g,m,v,_,w,y,b,x,k,C,S,T,D,A,P,M,E;if(e=e||[],n=n||{},o=n.measures||[],r="rows"===n.measuresAxis,a=(r?n.rows:n.columns)||[],s=(r?n.columns:n.rows)||[],!a.length&&s.length&&(!o.length||o.length&&r)&&(a=s,s=[],r=!1),a.length||s.length||(r=!1),!a.length&&o.length&&(a=i(n.measures)),l={},u={},h={},p={columnIndex:0},g=this._measureAggregators(n),m=this._buildGetters(a),v=this._buildGetters(s),_=!1,a.length||s.length)for(b=this._isExpanded(s),_=!0,x=0,k=e.length;k>x;x++)for(w=e[x],y={dataItem:w,index:x},C=l[Et]||{items:{},aggregates:{}},this._processColumns(g,a,m,u,y,C,p,!b),C.aggregates=this._calculateAggregate(g,y,C),l[Et]=C,S=0,T=s.length;T>S;S++)if(D=s[S],D.expand){if(!this._matchDescriptors(w,s,v,S))continue;A=O(D),f=v[A](w),f=f!==t?""+f:f,h[f]={name:A+"&"+f,parentName:A,value:f},P=l[f]||{items:{},aggregates:{}},this._processColumns(g,a,m,u,y,P,p,!0),P.aggregates=this._calculateAggregate(g,y,P),l[f]=P}return _&&e.length?(!(g.length>1)||n.columns&&n.columns.length||(a=[]),u=this._asTuples(u,a,g),h=this._asTuples(h,s,[]),M=u.length,r&&(M=1,E=u,u=h,h=E),l=this._toDataArray(l,u.length,n.measures,M,r?c:d),l=this._normalizeData(l,u.length,h.length)):l=u=h=[],{axes:{columns:{tuples:u},rows:{tuples:h}},data:l}},_normalizeData:function(e,t,n){var i,o,r=(t||1)*(n||1),a=Array(r),s=e.length;if(s===r)return e;for(o=0;r>o;o++)a[o]={value:"",fmtValue:"",ordinal:o};for(o=0;s>o;o++)i=e[o],i&&(a[i.ordinal]=i);return a}}),Gt=mt.extend({init:function(e,t){this.transport=t,this.options=t.options||{},this.transport.discover||kt(e.discover)&&(this.discover=e.discover)},read:function(e){return this.transport.read(e)},update:function(e){return this.transport.update(e)},create:function(e){return this.transport.create(e)},destroy:function(e){return this.transport.destroy(e)},discover:function(e){return this.transport.discover?this.transport.discover(e):(e.success({}),t)},catalog:function(n){var i,o=this.options||{};return n===t?(o.connection||{}).catalog:(i=o.connection||{},i.catalog=n,this.options.connection=i,e.extend(this.transport.options,{connection:i}),t)},cube:function(e){var n,i=this.options||{};return e===t?(i.connection||{}).cube:(n=i.connection||{},n.cube=e,this.options.connection=n,xt(!0,this.transport.options,{connection:n}),t)}}),qt=_t.extend({init:function(t){var o,r=((t||{}).schema||{}).cube,a="columns",s={axes:yt,cubes:yt,catalogs:yt,measures:yt,dimensions:yt,hierarchies:yt,levels:yt,members:yt};r&&(s=e.extend(s,this._cubeSchema(r)),this.cubeBuilder=new jt(r)),_t.fn.init.call(this,xt(!0,{},{schema:s},t)),this.transport=new Gt(this.options.transport||{},this.transport),this._columns=i(this.options.columns),this._rows=i(this.options.rows),o=this.options.measures||[],"[object Object]"===wt.call(o)&&(a=o.axis||"columns",o=o.values||[]),this._measures=n(o),this._measuresAxis=a,this._axes={}},_cubeSchema:function(e){return{dimensions:function(){var t,n=[],i=e.dimensions;for(t in i)n.push({name:t,caption:i[t].caption||t,uniqueName:t,defaultHierarchy:t,type:1});return e.measures&&n.push({name:"Measures",caption:"Measures",uniqueName:"Measures",type:2}),n},hierarchies:function(){return[]},measures:function(){var t,n=[],i=e.measures;for(t in i)n.push({name:t,caption:t,uniqueName:t,aggregator:t});return n}}},options:{serverSorting:!0,serverPaging:!0,serverFiltering:!0,serverGrouping:!0,serverAggregates:!0},catalog:function(e){return e===t?this.transport.catalog():(this.transport.catalog(e),this._mergeState({}),this._axes={},this.data([]),t)},cube:function(e){return e===t?this.transport.cube():(this.transport.cube(e),this._axes={},this._mergeState({}),this.data([]),t)},axes:function(){return this._axes},columns:function(e){return e===t?this._columns:(this._clearAxesData=!0,this._columns=i(e),this.query({columns:e,rows:this.rowsAxisDescriptors(),measures:this.measures()}),t)},rows:function(e){return e===t?this._rows:(this._clearAxesData=!0,this._rows=i(e),this.query({columns:this.columnsAxisDescriptors(),rows:e,measures:this.measures()}),t)},measures:function(e){return e===t?this._measures:(this._clearAxesData=!0,this.query({columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:n(e)}),t)},measuresAxis:function(){return this._measuresAxis||"columns"},_expandPath:function(e,t){var n,o,r,a="columns"===t?"columns":"rows",s="columns"===t?"rows":"columns",c=i(e),d=O(c[c.length-1]);for(this._lastExpanded=a,c=l(this.axes()[a],c,this.measures()),n=0;c.length>n;n++)if(o=O(c[n]),o===d){if(c[n].expand)return;c[n].expand=!0}else c[n].expand=!1;r={},r[a]=c,r[s]=this._descriptorsForAxis(s),this._query(r)},_descriptorsForAxis:function(e){var t=this.axes(),n=this[e]()||[];return t&&t[e]&&t[e].tuples&&t[e].tuples[0]&&(n=r(t[e].tuples||[])),n},columnsAxisDescriptors:function(){return this._descriptorsForAxis("columns")},rowsAxisDescriptors:function(){return this._descriptorsForAxis("rows")},_process:function(e,t){this._view=e,t=t||{},t.items=t.items||this._view,this.trigger(Ct,t)},_query:function(e){var t=this;return e||(this._clearAxesData=!0),t.query(xt({},{page:t.page(),pageSize:t.pageSize(),sort:t.sort(),filter:t.filter(),group:t.group(),aggregate:t.aggregate(),columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:this.measures()},e))},query:function(t){var n=this._mergeState(t);return this._data.length&&this.cubeBuilder?(this._params(n),this._updateLocalData(this._pristineData),e.Deferred().resolve().promise()):this.read(n)},_mergeState:function(e){return e=_t.fn._mergeState.call(this,e),e!==t&&(this._measures=n(e.measures),e.columns?e.columns=i(e.columns):e.columns||(this._columns=[]),e.rows?e.rows=i(e.rows):e.rows||(this._rows=[])),e},filter:function(e){return e===t?this._filter:(this._clearAxesData=!0,this._query({filter:e,page:1}),t)},expandColumn:function(e){this._expandPath(e,"columns")},expandRow:function(e){this._expandPath(e,"rows")},success:function(e){var t;this.cubeBuilder&&(t=(this.reader.data(e)||[]).slice(0)),_t.fn.success.call(this,e),t&&(this._pristineData=t)},_processResult:function(e,t){var n,i,o,r,a,s,l,c,d,u,h;return this.cubeBuilder&&(n=this.cubeBuilder.process(e,this._requestData),e=n.data,t=n.axes),c=this.columns(),d=this.rows(),u=t.columns&&t.columns.tuples,c.length||!d.length||!u||!this._rowMeasures().length&&this.measures().length||(t={columns:{},rows:t.columns}),c.length||d.length||"rows"!==this.measuresAxis()||!u||(t={columns:{},rows:t.columns}),this._axes={columns:w(this._axes.columns),rows:w(this._axes.rows)},t={columns:w(t.columns),rows:w(t.rows)},i=this._normalizeTuples(t.columns.tuples,this._axes.columns.tuples,c,this._columnMeasures()),o=this._normalizeTuples(t.rows.tuples,this._axes.rows.tuples,d,this._rowMeasures()),this.cubeBuilder||(e=this._normalizeData({columnsLength:t.columns.tuples.length,rowsLength:t.rows.tuples.length,columnIndexes:i,rowIndexes:o,data:e})),"rows"==this._lastExpanded?(r=t.columns.tuples,s=this._columnMeasures(),a=p(t.columns,this._axes.columns,s),a&&(l="columns",t.columns=a,g(r,a.tuples,t.rows.tuples.length,s,e),e=this._normalizeData({columnsLength:_(t.columns.tuples,s),rowsLength:t.rows.tuples.length,data:e}))):"columns"==this._lastExpanded&&(r=t.rows.tuples,s=this._rowMeasures(),a=p(t.rows,this._axes.rows,s),a&&(l="rows",t.rows=a,m(r,a.tuples,t.columns.tuples.length,s,e),e=this._normalizeData({columnsLength:_(t.rows.tuples,s),rowsLength:t.columns.tuples.length,data:e}))),this._lastExpanded=null,h=this._mergeAxes(t,e,l),this._axes=h.axes,h.data},_readData:function(e){var t=this.reader.axes(e),n=this.reader.data(e);return this._processResult(n,t)},_createTuple:function(e,t,n){var i,o,r,a,s,l=e.members,c=l.length,d={members:[]},u=0;for(t&&(c-=1);c>u;u++)o=l[u],a=+o.levelNum,i=o.name,r=o.parentName,s=o.caption||i,n&&(s="All",0===a?r=o.name:a-=1,i=r),d.members.push({name:i,children:[],caption:s,levelName:r,levelNum:""+a,hasChildren:n,hierarchy:r,parentName:n?"":r});return t&&d.members.push({name:t.name,children:[]}),d},_hasRoot:function(e,t,n){var i,o,r,a,s,l,c;if(t.length)return k(t,e).tuple;for(i=e.members,a=!0,l=0,c=i.length;c>l;l++)if(o=i[l],s=+o.levelNum||0,r=n[l],!(0===s||r&&o.name===O(r))){a=!1;break}return a},_mergeAxes:function(e,t,n){var i,o,r,a,s,l=this._columnMeasures(),c=this._rowMeasures(),d=this.axes(),u=e.rows.tuples.length,h=_(d.columns.tuples,l),f=e.columns.tuples.length;return"columns"==n?(f=h,o=e.columns.tuples):(o=A(e.columns.tuples,l),t=M(o,t)),r=b(d.columns.tuples,o,l),"rows"==n?(u=_(e.rows.tuples,c),o=e.rows.tuples):(o=A(e.rows.tuples,c),t=P(o,t)),a=b(d.rows.tuples,o,c),d.columns.tuples=r.tuples,d.rows.tuples=a.tuples,h!==_(d.columns.tuples,l)?(i=r.index+y(r.parsedRoot,r.memberIndex,l),s=h+f,t=this._mergeColumnData(t,i,u,f,s)):(i=a.index+y(a.parsedRoot,a.memberIndex,c),t=this._mergeRowData(t,i,u,f)),{axes:d,data:t}},_mergeColumnData:function(e,t,n,i,o){var r,a,s,l=this.data().toJSON(),c=0,d=Math.max(this._columnMeasures().length,1);for(n=Math.max(n,1),l.length>0&&(c=d,o-=d),r=0;n>r;r++)a=t+r*o,s=e.splice(0,i),s.splice(0,c),[].splice.apply(l,[a,0].concat(s));return l},_mergeRowData:function(e,t,n,i){var o,r,a,s=this.data().toJSON(),l=Math.max(this._rowMeasures().length,1);for(i=Math.max(i,1),s.length>0&&(n-=l,e.splice(0,i*l)),o=0;n>o;o++)a=e.splice(0,i),r=t*i+o*i,[].splice.apply(s,[r,0].concat(a));return s},_columnMeasures:function(){var e=this.measures(),t=[];return"columns"===this.measuresAxis()&&(0===this.columns().length?t=e:e.length>1&&(t=e)),t},_rowMeasures:function(){var e=this.measures(),t=[];return"rows"===this.measuresAxis()&&(0===this.rows().length?t=e:e.length>1&&(t=e)),t},_updateLocalData:function(e,t){this.cubeBuilder&&(t&&(this._requestData=t),e=this._processResult(e)),this._data=this._observe(e),this._ranges=[],this._addRange(this._data),this._total=this._data.length,this._pristineTotal=this._total,this._process(this._data)},data:function(e){var n=this;return e===t?n._data:(this._pristineData=e.slice(0),this._updateLocalData(e,{columns:this.columns(),rows:this.rows(),measures:this.measures()}),t)},_normalizeTuples:function(e,t,n,i){var o,r,a,s=i.length||1,l=0,c=[],d={},u=0;if(e.length){if(!this._hasRoot(e[0],t,n)){for(;s>l;l++)c.push(this._createTuple(e[0],i[l],!0)),d[l]=l;e.splice.apply(e,[0,e.length].concat(c).concat(e)),l=s}if(i.length)for(a=o=e[l],r=o.members.length-1;o;){if(u>=s&&(u=0),o.members[r].name!==i[u].name&&(e.splice(l,0,this._createTuple(o,i[u])),d[l]=l),l+=1,u+=1,o=e[l],s>u&&(!o||ct(a,r-1)!==ct(o,r-1))){for(;s>u;u++)e.splice(l,0,this._createTuple(a,i[u])),d[l]=l,l+=1;o=e[l]}a=o}return d}},_normalizeData:function(e){var n,i,o=e.data,r=e.columnIndexes||{},a=e.rowIndexes||{},s=e.columnsLength||1,l=s*(e.rowsLength||1),c=0,d=0,u=0,h=Array(l);if(o.length===l)return o;for(;l>c;c++){for(;a[parseInt(c/s,10)]!==t;)for(i=0;s>i;i++)h[c]={value:"",fmtValue:"",ordinal:c},c+=1;if(r[c%s]!==t&&(h[c]={value:"",fmtValue:"",ordinal:c},c+=1),n=o[d]){if(n.ordinal-u>1)for(u+=1;n.ordinal>u;u++)h[c]={value:"",fmtValue:"",ordinal:c},c+=1;u=n.ordinal,n.ordinal=c,h[c]=n,d+=1}else h[c]={value:"",fmtValue:"",ordinal:c}}return h},discover:function(t,n){var i=this,o=i.transport;return e.Deferred(function(e){o.discover(xt({success:function(t){t=i.reader.parse(t),i._handleCustomErrors(t)||(n&&(t=n(t)),e.resolve(t))},error:function(t,n,o){e.reject(t),i.error(t,n,o)}},t))}).promise().done(function(){i.trigger("schemaChange")})},schemaMeasures:function(){var e=this;return e.discover({data:{command:"schemaMeasures",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.measures(t)})},schemaKPIs:function(){var e=this;return e.discover({data:{command:"schemaKPIs",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.kpis(t)})},schemaDimensions:function(){var e=this;return e.discover({data:{command:"schemaDimensions",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.dimensions(t)})},schemaHierarchies:function(e){var t=this;return t.discover({data:{command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:e}}},function(e){return t.reader.hierarchies(e)})},schemaLevels:function(e){var t=this;return t.discover({data:{command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:e}}},function(e){return t.reader.levels(e)})},schemaCubes:function(){var e=this;return e.discover({data:{command:"schemaCubes",restrictions:{catalogName:e.transport.catalog()}}},function(t){return e.reader.cubes(t)})},schemaCatalogs:function(){var e=this;return e.discover({data:{command:"schemaCatalogs"}},function(t){return e.reader.catalogs(t)})},schemaMembers:function(e){var t=this;return t.discover({data:{command:"schemaMembers",restrictions:xt({catalogName:t.transport.catalog(),cubeName:t.transport.cube()},e)}},function(e){return t.reader.members(e)})},_params:function(e){this._clearAxesData&&(this._axes={},this._data=this._observe([]),this._clearAxesData=!1,this.trigger(Dt));var t=_t.fn._params.call(this,e);return t=xt({measures:this.measures(),measuresAxis:this.measuresAxis(),columns:this.columns(),rows:this.rows()},t),this.cubeBuilder&&(this._requestData=t),t}});qt.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},n=t.data;if(t.data=n,!(t instanceof qt)&&t instanceof pt.data.DataSource)throw Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof qt?t:new qt(t)},Y={contains:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") > 0',doesnotcontain:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") = 0',startswith:', Left({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',endswith:', Right({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',eq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',neq:', NOT {0}.CurrentMember.MEMBER_CAPTION = "{1}"'},Q={schemaCubes:"MDSCHEMA_CUBES",schemaCatalogs:"DBSCHEMA_CATALOGS",schemaMeasures:"MDSCHEMA_MEASURES",schemaDimensions:"MDSCHEMA_DIMENSIONS",schemaHierarchies:"MDSCHEMA_HIERARCHIES",schemaLevels:"MDSCHEMA_LEVELS",schemaMembers:"MDSCHEMA_MEMBERS",schemaKPIs:"MDSCHEMA_KPIS"},X={read:function(e){var t,n,i,o,r,a='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement>';return a+="SELECT NON EMPTY {",t=e.columns||[],n=e.rows||[],i=e.measures||[],o="rows"===e.measuresAxis,r=e.sort||[],!t.length&&n.length&&(!i.length||i.length&&o)&&(t=n,n=[],o=!1),t.length||n.length||(o=!1),t.length?a+=U(t,o?[]:i,r):i.length&&!o&&(a+=R(i).join(",")),a+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS",(n.length||o&&i.length>1)&&(a+=", NON EMPTY {",a+=n.length?U(n,o?i:[],r):R(i).join(","),a+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS"),e.filter?(a+=" FROM ",a+="(",a+=j(e.filter,e.connection.cube),a+=")"):a+=" FROM ["+e.connection.cube+"]",1==i.length&&t.length&&(a+=" WHERE ("+R(i).join(",")+")"),a+="</Statement></Command><Properties><PropertyList><Catalog>"+e.connection.catalog+"</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>",a.replace(/\&/g,"&amp;")},discover:function(t){t=t||{};var n='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis">';return n+="<RequestType>"+(Q[t.command]||t.command)+"</RequestType>",n+="<Restrictions>"+G("RestrictionList",t.restrictions,!0)+"</Restrictions>",t.connection&&t.connection.catalog&&(t.properties=e.extend({},{Catalog:t.connection.catalog},t.properties)),n+="<Properties>"+G("PropertyList",t.properties)+"</Properties>",n+="</Discover></Body></Envelope>"}},K=pt.data.RemoteTransport.extend({init:function(e){var t=e;e=this.options=xt(!0,{},this.options,e),pt.data.RemoteTransport.call(this,e),kt(t.discover)?this.discover=t.discover:"string"==typeof t.discover?this.options.discover={url:t.discover}:t.discover||(this.options.discover=this.options.read)},setup:function(t,n){return t.data=t.data||{},e.extend(!0,t.data,{connection:this.options.connection}),pt.data.RemoteTransport.fn.setup.call(this,t,n)},options:{read:{dataType:"text",contentType:"text/xml",type:"POST"},discover:{dataType:"text",contentType:"text/xml",type:"POST"},parameterMap:function(e,t){return X[t](e,t)}},discover:function(t){return e.ajax(this.setup(t,"discover"))}}),Z={cubes:{name:pt.getter("CUBE_NAME['#text']",!0),caption:pt.getter("CUBE_CAPTION['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),type:pt.getter("CUBE_TYPE['#text']",!0)},catalogs:{name:pt.getter("CATALOG_NAME['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0)},measures:{name:pt.getter("MEASURE_NAME['#text']",!0),caption:pt.getter("MEASURE_CAPTION['#text']",!0),uniqueName:pt.getter("MEASURE_UNIQUE_NAME['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),aggregator:pt.getter("MEASURE_AGGREGATOR['#text']",!0),groupName:pt.getter("MEASUREGROUP_NAME['#text']",!0),displayFolder:pt.getter("MEASURE_DISPLAY_FOLDER['#text']",!0),defaultFormat:pt.getter("DEFAULT_FORMAT_STRING['#text']",!0)},kpis:{name:pt.getter("KPI_NAME['#text']",!0),caption:pt.getter("KPI_CAPTION['#text']",!0),value:pt.getter("KPI_VALUE['#text']",!0),goal:pt.getter("KPI_GOAL['#text']",!0),status:pt.getter("KPI_STATUS['#text']",!0),trend:pt.getter("KPI_TREND['#text']",!0),statusGraphic:pt.getter("KPI_STATUS_GRAPHIC['#text']",!0),trendGraphic:pt.getter("KPI_TREND_GRAPHIC['#text']",!0),description:pt.getter("KPI_DESCRIPTION['#text']",!0),groupName:pt.getter("MEASUREGROUP_NAME['#text']",!0)},dimensions:{name:pt.getter("DIMENSION_NAME['#text']",!0),caption:pt.getter("DIMENSION_CAPTION['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),uniqueName:pt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),defaultHierarchy:pt.getter("DEFAULT_HIERARCHY['#text']",!0),type:pt.getter("DIMENSION_TYPE['#text']",!0)},hierarchies:{name:pt.getter("HIERARCHY_NAME['#text']",!0),caption:pt.getter("HIERARCHY_CAPTION['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),uniqueName:pt.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),dimensionUniqueName:pt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:pt.getter("HIERARCHY_DISPLAY_FOLDER['#text']",!0),origin:pt.getter("HIERARCHY_ORIGIN['#text']",!0),defaultMember:pt.getter("DEFAULT_MEMBER['#text']",!0)},levels:{name:pt.getter("LEVEL_NAME['#text']",!0),caption:pt.getter("LEVEL_CAPTION['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),uniqueName:pt.getter("LEVEL_UNIQUE_NAME['#text']",!0),dimensionUniqueName:pt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:pt.getter("LEVEL_DISPLAY_FOLDER['#text']",!0),orderingProperty:pt.getter("LEVEL_ORDERING_PROPERTY['#text']",!0),origin:pt.getter("LEVEL_ORIGIN['#text']",!0),hierarchyUniqueName:pt.getter("HIERARCHY_UNIQUE_NAME['#text']",!0)},members:{name:pt.getter("MEMBER_NAME['#text']",!0),caption:pt.getter("MEMBER_CAPTION['#text']",!0),uniqueName:pt.getter("MEMBER_UNIQUE_NAME['#text']",!0),dimensionUniqueName:pt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),hierarchyUniqueName:pt.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),levelUniqueName:pt.getter("LEVEL_UNIQUE_NAME['#text']",!0),childrenCardinality:pt.getter("CHILDREN_CARDINALITY['#text']",!0)}},J=["axes","catalogs","cubes","dimensions","hierarchies","levels","measures"],et=pt.data.XmlDataReader.extend({init:function(e){pt.data.XmlDataReader.call(this,e),this._extend(e)
},_extend:function(e){for(var t,n,i=0,o=J.length;o>i;i++)t=J[i],n=e[t],n&&n!==yt&&(this[t]=n)},parse:function(e){var t=pt.data.XmlDataReader.fn.parse(e.replace(/<(\/?)(\w|-)+:/g,"<$1"));return pt.getter("['Envelope']['Body']",!0)(t)},errors:function(e){var t=pt.getter("['Fault']",!0)(e);return t?[{faultstring:pt.getter("faultstring['#text']",!0)(t),faultcode:pt.getter("faultcode['#text']",!0)(t)}]:null},axes:function(e){var t,n,i;return e=pt.getter('ExecuteResponse["return"].root',!0)(e),t=q(pt.getter("Axes.Axis",!0)(e)),n=$(t[0]),i={},t.length>2&&(i=$(t[1])),{columns:n,rows:i}},data:function(e){var t,n,i,o,r,a;for(e=pt.getter('ExecuteResponse["return"].root',!0)(e),t=q(pt.getter("CellData.Cell",!0)(e)),n=[],i=pt.getter("['@CellOrdinal']"),o=pt.getter("Value['#text']"),r=pt.getter("FmtValue['#text']"),a=0;t.length>a;a++)n.push({value:o(t[a]),fmtValue:r(t[a]),ordinal:parseInt(i(t[a]),10)});return n},_mapSchema:function(e,t){var n,i,o,r,a;for(e=pt.getter('DiscoverResponse["return"].root',!0)(e),n=q(pt.getter("row",!0)(e)),i=[],o=0;n.length>o;o++){r={};for(a in t)r[a]=t[a](n[o]);i.push(r)}return i},measures:function(e){return this._mapSchema(e,Z.measures)},kpis:function(e){return this._mapSchema(e,Z.kpis)},hierarchies:function(e){return this._mapSchema(e,Z.hierarchies)},levels:function(e){return this._mapSchema(e,Z.levels)},dimensions:function(e){return this._mapSchema(e,Z.dimensions)},cubes:function(e){return this._mapSchema(e,Z.cubes)},catalogs:function(e){return this._mapSchema(e,Z.catalogs)},members:function(e){return this._mapSchema(e,Z.members)}}),xt(!0,pt.data,{PivotDataSource:qt,XmlaTransport:K,XmlaDataReader:et,PivotCubeBuilder:jt,transports:{xmla:K},readers:{xmla:et}}),tt=function(e,t){if(!e)return null;for(var n=0,i=e.length;i>n;n++)if(e[n].field===t)return e[n];return null},nt=function(e,t){var n,i,o=[];for(n=0,i=e.length;i>n;n++)e[n].field!==t&&o.push(e[n]);return o},pt.ui.PivotSettingTarget=vt.extend({init:function(t,n){var i=this;vt.fn.init.call(i,t,n),i.element.addClass("k-pivot-setting"),i.dataSource=pt.data.PivotDataSource.create(n.dataSource),i._refreshHandler=e.proxy(i.refresh,i),i.dataSource.first(Ct,i._refreshHandler),n.template||(i.options.template="<div data-"+pt.ns+'name="${data.name || data}">${data.name || data}'+(i.options.enabled?'<a class="k-button k-button-icon k-button-bare"><span class="k-icon k-setting-delete"></span></a>':"")+"</div>"),i.template=pt.template(i.options.template),i.emptyTemplate=pt.template(i.options.emptyTemplate),i._sortable(),i.element.on("click"+Mt,".k-button,.k-item",function(t){var n=e(t.target),o=n.closest("["+pt.attr("name")+"]").attr(pt.attr("name"));o&&(n.hasClass("k-setting-delete")?i.remove(o):i.options.sortable&&n[0]===t.currentTarget&&i.sort({field:o,dir:n.find(".k-i-sort-asc")[0]?"desc":"asc"}))}),(n.filterable||n.sortable)&&(i.fieldMenu=new gt.PivotFieldMenu(i.element,{messages:i.options.messages.fieldMenu,filter:".k-setting-fieldmenu",filterable:n.filterable,sortable:n.sortable,dataSource:i.dataSource})),i.refresh()},options:{name:"PivotSettingTarget",template:null,filterable:!1,sortable:!1,emptyTemplate:"<div class='k-empty'>${data}</div>",setting:"columns",enabled:!0,messages:{empty:"Drop Fields Here"}},setDataSource:function(e){this.dataSource.unbind(Ct,this._refreshHandler),this.dataSource=this.options.dataSource=e,this.fieldMenu&&this.fieldMenu.setDataSource(e),e.first(Ct,this._refreshHandler),this.refresh()},_sortable:function(){var e=this;e.options.enabled&&(this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,filter:">:not(.k-empty)",hint:e.options.hint,cursor:"move",start:function(e){e.item.focus().blur()},change:function(t){var n=t.item.attr(pt.attr("name"));"receive"==t.action?e.add(n):"remove"==t.action?e.remove(n):"sort"==t.action&&e.move(n,t.newIndex)}}).data("kendoSortable"))},_indexOf:function(e,t){var n,i,o=-1;for(n=0,i=t.length;i>n;n++)if(O(t[n])===e){o=n;break}return o},_isKPI:function(e){return"kpi"===e.type||e.measure},validate:function(e){var t,n,i=2==e.type||"aggregator"in e||this._isKPI(e);return i?"measures"===this.options.setting:"measures"===this.options.setting?i:(t=this.dataSource[this.options.setting](),n=e.defaultHierarchy||e.uniqueName,this._indexOf(n,t)>-1?!1:(t=this.dataSource["columns"===this.options.setting?"rows":"columns"](),this._indexOf(n,t)>-1?!1:!0))},add:function(t){var n,i,o=this.dataSource[this.options.setting]();for(t=e.isArray(t)?t.slice(0):[t],n=0,i=t.length;i>n;n++)-1!==this._indexOf(t[n],o)&&(t.splice(n,1),n-=1,i-=1);t.length&&(o=o.concat(t),this.dataSource[this.options.setting](o))},move:function(e,t){var n=this.dataSource[this.options.setting](),i=this._indexOf(e,n);i>-1&&(e=n.splice(i,1)[0],n.splice(t,0,e),this.dataSource[this.options.setting](n))},remove:function(e){var t=this.dataSource[this.options.setting](),n=this._indexOf(e,t);n>-1&&(t.splice(n,1),this.dataSource[this.options.setting](t))},sort:function(e){var t=this.options.sortable,n=t===!0||t.allowUnsort,i=n&&"asc"===e.dir,o=this.dataSource.sort()||[],r=nt(o,e.field);i&&o.length!==r.length&&(e=null),e&&r.push(e),this.dataSource.sort(r)},refresh:function(){var e,n="",i=this.dataSource[this.options.setting](),o=i.length,r=0;if(o)for(;o>r;r++)e=i[r],e=e.name===t?{name:e}:e,n+=this.template(xt({sortIcon:this._sortIcon(e.name)},e));else n=this.emptyTemplate(this.options.messages.empty);this.element.html(n)},destroy:function(){vt.fn.destroy.call(this),this.dataSource.unbind(Ct,this._refreshHandler),this.element.off(Mt),this.sortable&&this.sortable.destroy(),this.fieldMenu&&this.fieldMenu.destroy(),this.element=null,this._refreshHandler=null},_sortIcon:function(e){var t=this.dataSource.sort(),n=tt(t,O(e)),i="";return n&&(i="k-i-sort-"+n.dir),i}}),it=vt.extend({init:function(n,i){var o,r,a=this;vt.fn.init.call(a,n,i),a._dataSource(),a._bindConfigurator(),a._wrapper(),a._createLayout(),a._columnBuilder=o=new dt,a._rowBuilder=r=new ut,a._contentBuilder=new ht,a._templates(),a.columnsHeader.add(a.rowsHeader).on("click","span.k-icon",function(){var n,i,s,l,c=e(this),d=o,u="expandColumn",h=c.attr(pt.attr("path")),f={axis:"columns",path:e.parseJSON(h)};c.parent().is("td")&&(d=r,u="expandRow",f.axis="rows"),i=c.hasClass(Ft),s=d.metadata[h],l=s.expanded===t,n=i?Lt:zt,a.trigger(n,f)||(d.metadata[h].expanded=!i,c.toggleClass(Ft,!i).toggleClass(Rt,i),!i&&l?a.dataSource[u](f.path):a.refresh())}),a._scrollable(),a.options.autoBind&&a.dataSource.fetch(),pt.notify(a)},events:[It,Bt,zt,Lt],options:{name:"PivotGrid",autoBind:!0,reorderable:!0,filterable:!1,sortable:!1,height:null,columnWidth:100,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null,kpiStatusTemplate:null,kpiTrendTemplate:null,messages:{measureFields:"Drop Data Fields Here",columnFields:"Drop Column Fields Here",rowFields:"Drop Rows Fields Here"}},_templates:function(){var e=this.options.columnHeaderTemplate,t=this.options.rowHeaderTemplate,n=this.options.dataCellTemplate,i=this.options.kpiStatusTemplate,o=this.options.kpiTrendTemplate;this._columnBuilder.template=pt.template(e||Ot,{useWithBlock:!!e}),this._contentBuilder.dataTemplate=pt.template(n||Vt,{useWithBlock:!!n}),this._contentBuilder.kpiStatusTemplate=pt.template(i||Nt,{useWithBlock:!!i}),this._contentBuilder.kpiTrendTemplate=pt.template(o||Ht,{useWithBlock:!!o}),this._rowBuilder.template=pt.template(t||Ot,{useWithBlock:!!t})},_bindConfigurator:function(){var t=this.options.configurator;t&&e(t).kendoPivotConfigurator("setDataSource",this.dataSource)},cellInfoByElement:function(t){return t=e(t),this.cellInfo(t.index(),t.parent("tr").index())},cellInfo:function(e,t){var n,i=this._contentBuilder,o=i.columnIndexes[e||0],r=i.rowIndexes[t||0];return o&&r?(n=r.index*i.rowLength+o.index,{columnTuple:o.tuple,rowTuple:r.tuple,measure:o.measure||r.measure,dataItem:this.dataSource.view()[n]}):null},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.measuresTarget&&this.measuresTarget.setDataSource(e),this.rowsTarget&&this.rowsTarget.setDataSource(e),this.columnsTarget&&this.columnsTarget.setDataSource(e),this._bindConfigurator(),this.options.autoBind&&e.fetch()},setOptions:function(e){vt.fn.setOptions.call(this,e),this._templates()},_dataSource:function(){var t=this,n=t.options.dataSource;n=e.isArray(n)?{data:n}:n,t.dataSource&&this._refreshHandler?t.dataSource.unbind(Ct,t._refreshHandler).unbind(Dt,t._stateResetHandler).unbind(Tt,t._progressHandler).unbind(St,t._errorHandler):(t._refreshHandler=e.proxy(t.refresh,t),t._progressHandler=e.proxy(t._requestStart,t),t._stateResetHandler=e.proxy(t._stateReset,t),t._errorHandler=e.proxy(t._error,t)),t.dataSource=pt.data.PivotDataSource.create(n).bind(Ct,t._refreshHandler).bind(Tt,t._progressHandler).bind(Dt,t._stateResetHandler).bind(St,t._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_stateReset:function(){this._columnBuilder.reset(),this._rowBuilder.reset()},_wrapper:function(){var e=this.options.height;this.wrapper=this.element.addClass("k-widget k-pivot"),e&&this.wrapper.css("height",e)},_measureFields:function(){this.measureFields=e(Pt).addClass("k-pivot-toolbar k-header k-settings-measures"),this.measuresTarget=this._createSettingTarget(this.measureFields,{setting:"measures",messages:{empty:this.options.messages.measureFields}})},_createSettingTarget:function(t,n){var i='<span tabindex="0" class="k-button" data-'+pt.ns+'name="${data.name}">${data.name}',o=n.sortable,r="";return o&&(r+="#if (data.sortIcon) {#",r+='<span class="k-icon ${data.sortIcon} k-setting-sort"></span>',r+="#}#"),(n.filterable||o)&&(r+='<span class="k-icon k-i-arrowhead-s k-setting-fieldmenu"></span>'),this.options.reorderable&&(r+='<span class="k-icon k-si-close k-setting-delete"></span>'),r&&(i+='<span class="k-field-actions">'+r+"</span>"),i+="</span>",new pt.ui.PivotSettingTarget(t,e.extend({template:i,emptyTemplate:'<span class="k-empty">${data}</span>',enabled:this.options.reorderable,dataSource:this.dataSource},n))},_initSettingTargets:function(){this.columnsTarget=this._createSettingTarget(this.columnFields,{connectWith:this.rowFields,setting:"columns",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.columnFields,fieldMenu:this.options.messages.fieldMenu}}),this.rowsTarget=this._createSettingTarget(this.rowFields,{connectWith:this.columnFields,setting:"rows",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.rowFields,fieldMenu:this.options.messages.fieldMenu}})},_createLayout:function(){var t=this,n=e(Ut),i=n.find(".k-pivot-rowheaders"),o=n.find(".k-pivot-table"),r=e(Pt).addClass("k-grid k-widget");t._measureFields(),t.columnFields=e(Pt).addClass("k-pivot-toolbar k-header k-settings-columns"),t.rowFields=e(Pt).addClass("k-pivot-toolbar k-header k-settings-rows"),t.columnsHeader=e('<div class="k-grid-header-wrap" />').wrap('<div class="k-grid-header" />'),t.columnsHeader.parent().css("padding-right",pt.support.scrollbar()),t.rowsHeader=e('<div class="k-grid k-widget k-alt"/>'),t.content=e('<div class="k-grid-content" />'),i.append(t.measureFields),i.append(t.rowFields),i.append(t.rowsHeader),r.append(t.columnsHeader.parent()),r.append(t.content),o.append(t.columnFields),o.append(r),t.wrapper.append(n),t.columnsHeaderTree=new pt.dom.Tree(t.columnsHeader[0]),t.rowsHeaderTree=new pt.dom.Tree(t.rowsHeader[0]),t.contentTree=new pt.dom.Tree(t.content[0]),t._initSettingTargets()},_progress:function(e){pt.ui.progress(this.wrapper,e)},_resize:function(){var e=this.columnsHeader.children("table"),t=this.content.children("table");this.content[0].firstChild&&(this._setSectionsWidth(),this._setSectionsHeight(),this._setContentWidth(),this._setContentHeight(),e.css("table-layout",At),t.css("table-layout",At),clearTimeout(this._layoutTimeout),this._layoutTimeout=setTimeout(function(){e.css("table-layout","fixed"),t.css("table-layout","fixed")}))},_setSectionsWidth:function(){var e=this.rowsHeader,t=e.parent(".k-pivot-rowheaders").width(At),n=Math.max(this.measureFields.outerWidth(),this.rowFields.outerWidth());n=Math.max(e.children("table").width(),n),t.width(n)},_setSectionsHeight:function(){var e=this.measureFields.height(At).height(),t=this.columnFields.height(At).height(),n=this.rowFields.height(At).innerHeight(),i=this.columnsHeader.height(At).innerHeight(),o=n-this.rowFields.height(),r=t>e?t:e,a=i>n?i:n;this.measureFields.height(r),this.columnFields.height(r),this.rowFields.height(a-o),this.columnsHeader.height(a)},_setContentWidth:function(){var e=this.content.find("table"),t=this.content.width(),n=e.children("colgroup").children().length,i=100,o=n*this.options.columnWidth;o>t&&(i=Math.ceil(o/t*100)),e.add(this.columnsHeader.children("table")).css("width",i+"%")},_setContentHeight:function(){var e=this,n=e.content,i=e.rowsHeader,o=e.wrapper.innerHeight(),r=pt.support.scrollbar(),a=n[0].offsetHeight===n[0].clientHeight;if(e.wrapper.is(":visible")){if(!o)return a&&(r=0),i.height(n.height()-r),t;o-=e.columnFields.outerHeight(),o-=e.columnsHeader.outerHeight(),2*r>=o&&(o=2*r+1,a||(o+=r)),n.height(o),a&&(r=0),i.height(o-r)}},_axisMeasures:function(e){var t=[],n=this.dataSource,i=n.measures(),o=i.length>1||i[0]&&i[0].type;return n.measuresAxis()===e&&(0===n[e]().length||o)&&(t=i),t},refresh:function(){var e,t=this,n=t.dataSource,i=n.axes(),o=(i.columns||{}).tuples||[],r=(i.rows||{}).tuples||[],a=t._columnBuilder,s=t._rowBuilder,l={},c={};t.trigger(It,{action:"rebind"})||(a.measures=this._axisMeasures("columns"),t.columnsHeaderTree.render(a.build(o)),t.rowsHeaderTree.render(s.build(r)),l={indexes:a._indexes,measures:a.measures,metadata:a.metadata},c={indexes:s._indexes,measures:this._axisMeasures("rows"),metadata:s.metadata},t.contentTree.render(t._contentBuilder.build(n.view(),l,c)),t._resize(),t.touchScroller?t.touchScroller.contentResized():(e=pt.touchScroller(t.content),e&&e.movable&&(t.touchScroller=e,e.movable.bind("change",function(e){t.columnsHeader.scrollLeft(-e.sender.x),t.rowsHeader.scrollTop(-e.sender.y)}))),t._progress(!1),t.trigger(Bt))},_scrollable:function(){var t=this,n=t.columnsHeader,i=t.rowsHeader;t.content.scroll(function(){n.scrollLeft(this.scrollLeft),i.scrollTop(this.scrollTop)}),i.bind("DOMMouseScroll"+Mt+" mousewheel"+Mt,e.proxy(t._wheelScroll,t))},_wheelScroll:function(t){var n,i;t.ctrlKey||(n=pt.wheelDeltaY(t),i=this.content.scrollTop(),n&&(t.preventDefault(),e(t.currentTarget).one("wheel"+Mt,!1),this.rowsHeader.scrollTop(i+-n),this.content.scrollTop(i+-n)))}}),ot=pt.dom.element,rt=pt.dom.html,at=pt.dom.text,st=function(e,t){return{maxChildren:0,children:0,maxMembers:0,members:0,measures:1,levelNum:e,parentMember:0!==t}},lt=function(e,t){for(var n=[],i=0;t>=i;i++)n.push(e.members[i].name);return n},ct=function(e,t){for(var n="",i=0;t>=i;i++)n+=e.members[i].name;return n},dt=mt.extend({init:function(){this.measures=1,this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[ot("table",null,[n,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var e=this._rowLength(),t=[],n=0;e>n;n++)t.push(ot("col",null));return ot("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.map={},this.rows=[],this.rootTuple=t,this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(ot("tr",null,[ot("th",null,[rt("&nbsp;")])])),ot("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,o,r=this.rows,a=r.length,s=0;a>s;s++)if(e=r[s],1!==e.rowSpan)for(i=e.children,n=0,t=i.length;t>n;n++)o=i[n],o.tupleAll&&(o.attr.rowSpan=e.rowSpan)},_rowIndex:function(e){for(var t=this.rows,n=t.length,i=0;n>i&&t[i]!==e;i++);return i},_rowLength:function(){var e=this.rows[0]?this.rows[0].children:[],t=e.length,n=0,i=0;if(t)for(;t>i;i++)n+=e[i].attr.colSpan||1;return n||(n=this.measures),n},_row:function(e,t,n){var i,o,r=this.rootTuple.members[t].name,a=e.members[t].levelNum,s=r+a,l=this.map,c=l[s];return c?(c.notFirst=!1,c.parentMember&&c.parentMember===n||(c.parentMember=n,c.colSpan=0)):(c=ot("tr",null,[]),c.parentMember=n,c.colSpan=0,c.rowSpan=1,l[s]=c,i=l[r+(+a-1)],i&&(o=i.children,c.notFirst=o[1]&&-1===o[1].attr.className.indexOf("k-alt")?!0:i.notFirst),this.rows.splice(this._rowIndex(i)+1,0,c)),c},_measures:function(e,t,n){var i,o,r,a=this.map,s=a.measureRow;for(s||(s=ot("tr",null,[]),a.measureRow=s,this.rows.push(s)),o=0,r=e.length;r>o;o++)i=e[o],s.children.push(this._cell(n||"",[this._content(i,t)],i));return r},_content:function(e,t){return rt(this.template({member:e,tuple:t}))},_cell:function(e,t,n){var i=ot("th",{className:"k-header"+e},t);return i.value=n.caption||n.name,i},_buildRows:function(e,n,i){var o,r,a,s,l,c,d,u,h,f,p=e.members,g=p[n],m=p[n+1],v=[],_=0;if(g.measure)return this._measures(g.children,e),t;if(u=pt.stringify(lt(e,n)),o=this._row(e,n,i),a=g.children,s=a.length,f=this.metadata[u],f||(this.metadata[u]=f=st(+g.levelNum,n)),this._indexes.push({path:u,tuple:e}),g.hasChildren&&(f.expanded===!1&&(s=0,f.children=0),d={className:"k-icon "+(s?Ft:Rt)},d[pt.attr("path")]=u,v.push(ot("span",d))),v.push(this._content(g,e)),l=this._cell(o.notFirst?" k-first":"",v,g),o.children.push(l),o.colSpan+=1,s){for(c=this._cell(" k-alt",[this._content(g,e)],g),o.children.push(c);s>_;_++)r=this._buildRows(a[_],n,g);h=r.colSpan,l.attr.colSpan=h,f.children=h,f.members=1,o.colSpan+=h,o.rowSpan=r.rowSpan+1,m&&(h=m.measure?this._measures(m.children,e," k-alt"):this._buildRows(e,n+1).colSpan,c.attr.colSpan=h,h-=1,f.members+=h,o.colSpan+=h)}else m&&(h=m.measure?this._measures(m.children,e):this._buildRows(e,n+1).colSpan,f.members=h,h>1&&(l.attr.colSpan=h,o.colSpan+=h-1));return f.children>f.maxChildren&&(f.maxChildren=f.children),f.members>f.maxMembers&&(f.maxMembers=f.members),(c||l).tupleAll=!0,o}}),ut=mt.extend({init:function(){this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[ot("table",null,[n,t])]},reset:function(){this.metadata={}},_rowLength:function(){for(var e=this.rows[0].children,t=0,n=0,i=e[n];i;)t+=i.attr.colSpan||1,i=e[++n];return t},_colGroup:function(){for(var e=this._rowLength(),t=[],n=0;e>n;n++)t.push(ot("col",null));return ot("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.rootTuple=t,this.rows=[],this.map={},this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(ot("tr",null,[ot("td",null,[rt("&nbsp;")])])),ot("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,o=this.rows,r=o.length,a=0,s=this.rootTuple.members,l=s[0].name,c=s.length,d=0,u=this.map;r>a;a++)for(e=o[a],d=0;c>d;d++)n=this[s[d].name],t=e.colSpan["dim"+d],t&&n>t.levelNum&&(t.attr.colSpan=n-t.levelNum+1);e=u[l],i=u[l+"all"],e&&(e.children[0].attr.className="k-first"),i&&(i.children[0].attr.className+=" k-first")},_row:function(e){var t=ot("tr",null,e);return t.rowSpan=1,t.colSpan={},this.rows.push(t),t},_content:function(e,t){return rt(this.template({member:e,tuple:t}))},_cell:function(e,t,n){var i=ot("td",{className:e},t);return i.value=n.caption||n.name,i},_buildRows:function(e,t){var n,i,o,r,a,s,l,c,d,u=this.map,h=e.members,f=h[t],p=h[t+1],g=f.children,m=g.length,v=+f.levelNum+1,_=this.rootTuple.members[t].name,w=lt(e,t-1).join(""),y=w+(f.parentName||""),b=u[y+"all"]||u[y],x=[];if(!b||b.hasChild?b=this._row():b.hasChild=!0,f.measure){for(a=b.allCell?"k-grid-footer":"",b.children.push(this._cell(a,[this._content(g[0],e)],g[0])),b.rowSpan=m,d=1;m>d;d++)this._row([this._cell(a,[this._content(g[d],e)],g[d])]);return b}if(u[w+f.name]=b,n=pt.stringify(lt(e,t)),r=this.metadata[n],r||(this.metadata[n]=r=st(v-1,t)),this._indexes.push({path:n,tuple:e}),f.hasChildren&&(r.expanded===!1&&(m=0,r.children=0),s={className:"k-icon "+(m?Ft:Rt)},s[pt.attr("path")]=n,x.push(ot("span",s))),x.push(this._content(f,e)),a=b.allCell&&!m?"k-grid-footer":"",c=this._cell(a,x,f),c.levelNum=v,b.children.push(c),b.colSpan["dim"+t]=c,(!this[_]||v>this[_])&&(this[_]=v),m){for(b.allCell=!1,b.hasChild=!1,d=0;m>d;d++)i=this._buildRows(g[d],t),b!==i&&(b.rowSpan+=i.rowSpan);b.rowSpan>1&&(c.attr.rowSpan=b.rowSpan),r.children=b.rowSpan,l=this._cell("k-grid-footer",[this._content(f,e)],f),l.levelNum=v,o=this._row([l]),o.colSpan["dim"+t]=l,o.allCell=!0,u[w+f.name+"all"]=o,p&&(i=this._buildRows(e,t+1),l.attr.rowSpan=i.rowSpan),b.rowSpan+=o.rowSpan,r.members=o.rowSpan}else p&&(b.hasChild=!1,this._buildRows(e,t+1),(l||c).attr.rowSpan=b.rowSpan,r.members=b.rowSpan);return r.children>r.maxChildren&&(r.maxChildren=r.children),r.members>r.maxMembers&&(r.maxMembers=r.members),b}}),ht=mt.extend({init:function(){this.columnAxis={},this.rowAxis={}},build:function(e,n,i){var o,r,a=n.indexes[0],s=n.metadata[a?a.path:t];return this.columnAxis=n,this.rowAxis=i,this.data=e,this.rowLength=s?s.maxChildren+s.maxMembers:n.measures.length||1,this.rowLength||(this.rowLength=1),o=this._tbody(),r=this._colGroup(),[ot("table",null,[r,o])]},_colGroup:function(){var e=this.columnAxis.measures.length||1,t=[],n=0;for(this.rows[0]&&(e=this.rows[0].children.length);e>n;n++)t.push(ot("col",null));return ot("colgroup",null,t)},_tbody:function(){return this.rows=[],this.data[0]?(this.columnIndexes=this._indexes(this.columnAxis),this.rowIndexes=this._indexes(this.rowAxis),this._buildRows()):this.rows.push(ot("tr",null,[ot("td",null,[rt("&nbsp;")])])),ot("tbody",null,this.rows)},_indexes:function(e){var n,i,o,r,a,s=[],l=e.indexes,c=e.metadata,d=e.measures,u=d.length||1,h=0,f=0,p=0,g=l.length;if(!g){for(o=0;u>o;o++)s[o]={index:o,measure:d[o],tuple:null};return s}for(;g>p;p++){if(n=l[p],i=c[n.path],r=i.children+i.members,a=0,r&&(r-=u),i.expanded===!1&&i.children!==i.maxChildren&&(a=i.maxChildren),i.parentMember&&0===i.levelNum&&(r=-1),r>-1){for(o=0;u>o;o++)s[r+f+o]={children:r,index:h,measure:d[o],tuple:n.tuple},h+=1;for(;s[f]!==t;)f+=1}h+=a}return s},_buildRows:function(){for(var e=this.rowIndexes,t=e.length,n=0;t>n;n++)this.rows.push(this._buildRow(e[n]))},_buildRow:function(e){for(var t,n,i,o,r,a,s,l=e.index*this.rowLength,c=this.columnIndexes,d=c.length,u=[],h=0;d>h;h++)t=c[h],r={},t.children&&(r.className="k-alt"),o="",a=this.data[l+t.index],s=t.measure||e.measure,n={columnTuple:t.tuple,rowTuple:e.tuple,measure:s,dataItem:a},""!==a.value&&s&&s.type&&("status"===s.type?o=this.kpiStatusTemplate(n):"trend"===s.type&&(o=this.kpiTrendTemplate(n))),o||(o=this.dataTemplate(n)),i=ot("td",r,[rt(o)]),i.value=a.value,u.push(i);return r={},e.children&&(r.className="k-grid-footer"),ot("tr",r,u)}}),gt.plugin(it),pt.PivotExcelExporter=pt.Class.extend({init:function(e){this.options=e,this.widget=e.widget,this.dataSource=this.widget.dataSource},_columns:function(){var e,t=this.widget.columnsHeaderTree.children[0],n=this.widget.rowsHeaderTree.children[0],i=t.children[0].children.length,o=n.children[0].children.length,r=this.widget.options.columnWidth,a=[];if(o&&this.dataSource.data()[0])for(e=0;o>e;e++)a.push({autoWidth:!0});for(e=0;i>e;e++)a.push({autoWidth:!1,width:r});return a},_cells:function(e,t,n){for(var i,o,r,a,s,l=[],c=0,d=e.length;d>c;c++){for(o=[],r=e[c].children,i=r.length,a=0;i>a;a++)s=r[a],o.push({background:"#7a7a7a",color:"#fff",value:s.value,colSpan:s.attr.colSpan||1,rowSpan:s.attr.rowSpan||1});n&&n(o,c),l.push({cells:o,type:t})}return l},_rows:function(){var e,t,n=this.widget.columnsHeaderTree.children[0],i=this.widget.rowsHeaderTree.children[0],o=n.children[0].children.length,r=i.children[0].children.length,a=n.children[1].children,s=i.children[1].children,l=this.widget.contentTree.children[0].children[1].children,c=this._cells(a,"header");return r&&c[0].cells.splice(0,0,{background:"#7a7a7a",color:"#fff",value:"",colSpan:r,rowSpan:a.length}),e=function(e,t){for(var n,i,r=0,a=l[t].children;o>r;r++)n=a[r],i=+n.value,isNaN(i)&&(i=""),e.push({background:"#dfdfdf",color:"#333",value:i,colSpan:1,rowSpan:1})},t=this._cells(s,"data",e),c.concat(t)},_freezePane:function(){var e=this.widget.columnsHeaderTree.children[0],t=this.widget.rowsHeaderTree.children[0],n=t.children[0].children.length,i=e.children[1].children;return{colSplit:n,rowSplit:i.length}},workbook:function(){var t;return this.dataSource.view()[0]?(t=e.Deferred(),t.resolve()):t=this.dataSource.fetch(),t.then(e.proxy(function(){return{sheets:[{columns:this._columns(),rows:this._rows(),freezePane:this._freezePane(),filter:null}]}},this))}}),ft={extend:function(t){t.events.push("excelExport"),t.options.excel=e.extend(t.options.excel,this.options),t.saveAsExcel=this.saveAsExcel},options:{proxyURL:"",filterable:!1,fileName:"Export.xlsx"},saveAsExcel:function(){var t=this.options.excel||{},n=new pt.PivotExcelExporter({widget:this});n.workbook().then(e.proxy(function(e){if(!this.trigger("excelExport",{workbook:e})){var n=new pt.ooxml.Workbook(e);pt.saveAs({dataURI:n.toDataURL(),fileName:e.fileName||t.fileName,proxyURL:t.proxyURL,forceProxy:t.forceProxy})}},this))}},pt.PivotExcelMixin=ft,pt.ooxml&&pt.ooxml.Workbook&&ft.extend(it.prototype),pt.PDFMixin&&(pt.PDFMixin.extend(it.prototype),it.fn._drawPDF=function(){return this._drawPDFShadow()})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});